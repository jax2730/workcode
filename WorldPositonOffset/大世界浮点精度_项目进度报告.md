# å¤§ä¸–ç•Œæµ®ç‚¹ç²¾åº¦é—®é¢˜ - é¡¹ç›®è¿›åº¦æŠ¥å‘Š

**æ—¥æœŸ**: 2025-10-24  
**é¡¹ç›®**: Echo Engine Camera-Relative åæ ‡ç³»ä¿®å¤  
**çŠ¶æ€**: ğŸ”„ è¿›è¡Œä¸­ - CPUå±‚è¯Šæ–­é˜¶æ®µ

---

## ğŸ“‹ ç›®å½•

1. [é—®é¢˜æ¦‚è¿°](#é—®é¢˜æ¦‚è¿°)
2. [æŠ€æœ¯èƒŒæ™¯](#æŠ€æœ¯èƒŒæ™¯)
3. [é—®é¢˜è¯Šæ–­å†ç¨‹](#é—®é¢˜è¯Šæ–­å†ç¨‹)
4. [å·²å®Œæˆçš„ä¿®æ”¹](#å·²å®Œæˆçš„ä¿®æ”¹)
5. [å½“å‰é—®é¢˜åˆ†æ](#å½“å‰é—®é¢˜åˆ†æ)
6. [ä¸‹ä¸€æ­¥è®¡åˆ’](#ä¸‹ä¸€æ­¥è®¡åˆ’)
7. [å…³é”®ä»£ç ä¿®æ”¹è®°å½•](#å…³é”®ä»£ç ä¿®æ”¹è®°å½•)
8. [æ—¥å¿—åˆ†æ](#æ—¥å¿—åˆ†æ)

---

## é—®é¢˜æ¦‚è¿°

### é—®é¢˜æè¿°
åœ¨å¤§ä¸–ç•Œåœºæ™¯ä¸­ï¼ˆåæ ‡è¾¾åˆ° 7 ä½æ•°ï¼Œå¦‚ `-365472, 432224`ï¼‰ï¼Œç”±äº `float` ç²¾åº¦é™åˆ¶ï¼ˆ23ä½å°¾æ•°ï¼Œçº¦7-8ä½æœ‰æ•ˆæ•°å­—ï¼‰ï¼Œå¯¼è‡´ï¼š
- **åœ°å½¢å’Œæ¤è¢«å®Œå…¨ä¸å¯è§**
- **ç‰©ä½“æŠ–åŠ¨**ï¼ˆé¡¶ç‚¹ä½ç½®åœ¨æ•´æ•°é—´è·³å˜ï¼‰
- **è´´å›¾é”™ä½**ï¼ˆUVè®¡ç®—ä¸å‡†ï¼‰
- **æ³•çº¿é—ªçƒ**ï¼ˆæ³•çº¿ç©ºé—´è®¡ç®—è¯¯å·®ï¼‰

### é¢„æœŸç›®æ ‡
é€šè¿‡ **Camera-Relative åæ ‡ç³»**æŠ€æœ¯ï¼Œå°†æ‰€æœ‰åæ ‡è½¬æ¢ä¸ºç›¸å¯¹äºæ‘„åƒæœºçš„å°åæ ‡ï¼ˆå‡ ç™¾èŒƒå›´å†…ï¼‰ï¼Œä»è€Œï¼š
- âœ… æ¶ˆé™¤ç²¾åº¦æŸå¤±
- âœ… ä¿æŒæ¸²æŸ“è´¨é‡
- âœ… æ”¯æŒæ— é™å¤§ä¸–ç•Œ

---

## æŠ€æœ¯èƒŒæ™¯

### Camera-Relative åŸç†

#### ä¼ ç»Ÿåæ ‡ç³»
```
ä¸–ç•Œåæ ‡ = (-365472, 200, 432224)  â† å¤§æ•°å€¼ï¼Œfloat ç²¾åº¦æŸå¤±
```

#### Camera-Relative åæ ‡ç³»
```
1. è®¾ç½®ä¸–ç•ŒåŸç‚¹ WorldOrigin = (-366000, 0, 432000)
2. ç›¸å¯¹åæ ‡ = ä¸–ç•Œåæ ‡ - WorldOrigin
   = (-365472, 200, 432224) - (-366000, 0, 432000)
   = (528, 200, 224)  â† å°æ•°å€¼ï¼Œç²¾åº¦å®Œç¾ï¼
```

### æ•°å­¦åŸç†

#### ä¸–ç•ŒçŸ©é˜µå˜æ¢
```
åŸå§‹ï¼šW = [R | t]
CRåï¼šW' = [R | t - c]  // c = camera position
```

#### View çŸ©é˜µå˜æ¢
```
åŸå§‹ï¼šV = [R^T | -R^TÂ·c]
CRåï¼šV' = [R^T | 0]  // æ‘„åƒæœºåœ¨åŸç‚¹ï¼Œå¹³ç§»ä¸º0
```

#### å®Œæ•´å˜æ¢é“¾
```
p_clip = P Â· V' Â· W' Â· p_local
       = P Â· [R^T | 0] Â· [R | t-c] Â· p_local
       = P Â· V Â· W Â· p_local  // T^-1 Â· T = Iï¼Œæ•°å­¦ä¸Šç­‰ä»·ï¼
```

---

## é—®é¢˜è¯Šæ–­å†ç¨‹

### ç¬¬1é˜¶æ®µï¼šåˆå§‹é—®é¢˜ (æˆªå›¾ï¼šåªæœ‰å¤©ç©º)

**ç°è±¡**ï¼š
- ç”»é¢åªæ˜¾ç¤ºå¤©ç©º
- åœ°å½¢ã€æ¤è¢«ã€äººç‰©å…¨éƒ¨æ¶ˆå¤±
- åæ ‡æ˜¾ç¤ºï¼š`(-365472.0, 6.8, 432214.4)`

**åˆæ­¥è¯Šæ–­**ï¼š
```
[TERRAIN] CamPos=(-365472.0,9.7,432224.0) mOriginPos=(-1731152.0,0.0,-1480576.0)
          â†‘ å¤§åæ ‡                          â†‘ åœ°å½¢åŸç‚¹

è·ç¦» = sqrt((365472-1731152)^2 + (432224-1480576)^2) â‰ˆ 2000 km
â†’ å…¨éƒ¨è¢«è§†é”¥å‰”é™¤ï¼
```

---

### ç¬¬2é˜¶æ®µï¼šGPU Camera-Relative æµ‹è¯•

**å°è¯•1ï¼šåœ¨ GPU å±‚æºå¤´ç»Ÿä¸€å¤„ç†**

ä¿®æ”¹ `EchoGpuParamsManager.cpp:729-765`ï¼š
```cpp
// åœ¨ commitUniformParams ä¸­ç»Ÿä¸€å¤„ç†
DBMatrix4 T_CR, T_INV_CR;
T_CR.makeTransform(-camPos, ...);      // T = [I | -c]
T_INV_CR.makeTransform(camPos, ...);   // T^-1 = [I | c]

DBMatrix4 worldCR = T_CR * (*m_pWorldMatrix);     // W' = T Â· W
DBMatrix4 invWorldCR = (*mInvWorldMatrix) * T_INV_CR; // invW' = invW Â· T^-1

m_pWorldMatrix = &worldCR;
mInvWorldMatrix = &invWorldCR;
```

**é—®é¢˜**ï¼š
- âŒ å±€éƒ¨å˜é‡ `worldCR` åœ¨å‡½æ•°è¿”å›åè¢«é”€æ¯
- âŒ æŒ‡é’ˆæ‚¬ç©ºï¼ˆdangling pointerï¼‰
- âŒ æ‰€æœ‰ç‰©ä½“å…±ç”¨åŒä¸€ä¸ª `static` çŸ©é˜µï¼ˆæœ€åä¸€ä¸ªè¦†ç›–å‰é¢çš„ï¼‰

**å†³ç­–**ï¼š
- ğŸ”„ æš‚æ—¶å…³é—­ GPU camera-relativeï¼ˆ`g_EnableGpuCameraRelative = false`ï¼‰
- ğŸ” å…ˆè¯Šæ–­ CPU å±‚çš„é—®é¢˜

---

### ç¬¬3é˜¶æ®µï¼šCPU å±‚è¯Šæ–­

#### é—®é¢˜å‘ç°ï¼šWorldOrigin Rebasing æœºåˆ¶å·²å­˜åœ¨

**EchoMiniMap.cpp:1231-1299**ï¼š
```cpp
void MiniMapManager::Tick() {
    // æ£€æµ‹æ‘„åƒæœºè·ç¦»ä¸–ç•ŒåŸç‚¹è¶…è¿‡ 10kmï¼Œè§¦å‘ rebasing
    DVector3 currentOrigin = Root::instance()->getWorldOrigin();
    DVector3 cameraPosD(mPlayerWorldPosition);
    DVector3 offset = cameraPosD - currentOrigin;
    
    if (s_firstRebase || offset.squaredLength() > 10000.0 * 10000.0) {
        // å°†ä¸–ç•ŒåŸç‚¹è®¾ç½®åˆ°æ‘„åƒæœºé™„è¿‘
        DVector3 newOrigin(
            floor(cameraPosD.x / 1000.0) * 1000.0,
            0.0,
            floor(cameraPosD.z / 1000.0) * 1000.0
        );
        Root::instance()->changeWorldOrigin(newOrigin);  // è°ƒç”¨é‡å®šä½
    }
}
```

**EchoKarstGroup.cpp:478-530**ï¼š
```cpp
void KarstGroup::worldOriginRebasing(double origin_x, double origin_y, double origin_z) {
    DVector3 offset = DVector3(origin_x, origin_y, origin_z) - mWorldBasePosition;
    
    // æ›´æ–°åœ°å½¢åŸºå‡†ä½ç½®
    mWorldBasePosition = DVector3(origin_x, origin_y, origin_z);
    updateWorldBasePosition();
    
    // æ›´æ–°æ‘„åƒæœºä½ç½®
    Camera* mainCam = mSceneManager->getMainCamera();
    if (mainCam) {
        DVector3 oldCamPos = mainCam->getPosition();
        DVector3 newCamPos = oldCamPos - offset;  // è½¬æ¢ä¸ºç›¸å¯¹åæ ‡
        mainCam->setPosition(newCamPos);
    }
}
```

**æ—¥å¿—è¯æ®**ï¼š
```
15:02:12: [WorldOrigin Rebase] FirstTime=1 Dist=566.0km 
          OldOrigin=(0.0,0.0,0.0) NewOrigin=(-366000.0,0.0,432000.0) 
          Cam=(-365472.0,197.1,432214.4)
          
15:02:12: ========== [KarstGroup::worldOriginRebasing] CALLED! ==========
15:02:12: [KarstGroup::worldOriginRebasing] MainCamera OldPos=(-365472.0,200.0,432224.0) 
                                             NewPos=(528.0,200.0,224.0)
          â†‘ æ‘„åƒæœºæˆåŠŸæ›´æ–°ä¸ºå°åæ ‡ï¼âœ…
```

---

### ç¬¬4é˜¶æ®µï¼šå‘ç°å…³é”®é—®é¢˜ - æ‘„åƒæœºè¢«å¤–éƒ¨ç³»ç»Ÿè¦†ç›–

**17ç§’åçš„æ—¥å¿—**ï¼š
```
15:02:29: [WorldOrigin Check] Frame=60 
          CurrentOrigin=(-366000.0,0.0,432000.0) 
          CamPos=(-365472.0,6.8,432214.4)  â† åˆå˜å›å¤§åæ ‡ï¼âŒ
          Offset=(528.0,6.8,214.4) Dist=0.6km

15:02:29: [TERRAIN] Frame=60 CamPos=(-365472.0,9.7,432224.0)
          â†‘ ç¡®è®¤ï¼šæ‘„åƒæœºåˆæ˜¯å¤§åæ ‡
```

**æ ¹æœ¬åŸå› åˆ†æ**ï¼š

```
æ—¶é—´çº¿ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 15:02:12  worldOriginRebasing å›è°ƒ                          â”‚
â”‚           â”œâ”€ è®¾ç½® WorldOrigin = (-366000, 0, 432000)        â”‚
â”‚           â””â”€ æ›´æ–°æ‘„åƒæœº â†’ (528, 200, 224)  âœ…               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 15:02:12  å¸§æœ«ï¼ŒworldOriginRebasing æ‰§è¡Œå®Œæˆ                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 15:02:13  ä¸‹ä¸€å¸§å¼€å§‹                                         â”‚
â”‚           å¤–éƒ¨ç³»ç»Ÿï¼ˆè§’è‰²æ§åˆ¶å™¨ï¼Ÿï¼‰æ›´æ–°æ‘„åƒæœº                 â”‚
â”‚           â”œâ”€ è¯»å– mPlayerWorldPosition = (-365472, 6.8, ...) â”‚
â”‚           â””â”€ camera->setPosition(mPlayerWorldPosition)      â”‚
â”‚               â†‘ ç›´æ¥ç”¨å¤§åæ ‡è®¾ç½®ï¼è¦†ç›–äº†å°åæ ‡ï¼âŒ          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 15:02:29  Frame=60                                           â”‚
â”‚           æ‘„åƒæœº = (-365472, 9.7, 432224)  â† åˆæ˜¯å¤§åæ ‡     â”‚
â”‚           åœ°å½¢è·ç¦» â‰ˆ 2000 km â†’ è§†é”¥å‰”é™¤ â†’ ä¸å¯è§ âŒ        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…³é”®ç†è§£**ï¼ˆç”¨æˆ·çº æ­£ï¼‰ï¼š

> `mPlayerWorldPosition = (-365472, 6.8, 432214)` æ˜¯ç©å®¶åœ¨**æ•´ä¸ªå¤§åœ°å›¾**ä¸­çš„çœŸå®ä½ç½®ï¼ˆä¸–ç•Œåæ ‡ï¼‰ã€‚
> è¿™ä¸ªå€¼**åº”è¯¥ä¿æŒä¸å˜**ï¼
> 
> å¦‚æœæ”¹æˆå°åæ ‡ `(528, 6.8, 214)`ï¼Œäººç‰©å°±ä¼šè·‘åˆ°åœ°å›¾çš„ (528, 6.8, 214) ç‚¹ï¼Œè€Œä¸æ˜¯æ­£ç¡®çš„ (-365472, 6.8, 432214) ä½ç½®ï¼

**é”™è¯¯å°è¯•**ï¼ˆå·²æ’¤é”€ï¼‰ï¼š
```cpp
// âŒ é”™è¯¯ï¼šä¿®æ”¹äº† mPlayerWorldPosition
mPlayerWorldPosition -= Vector3(originDelta);  // ä» (-365472) å˜æˆ (528)
// è¿™ä¼šå¯¼è‡´ï¼š
// 1. å¤–éƒ¨ç³»ç»Ÿç”¨ (528) è®¾ç½®æ‘„åƒæœº â†’ äººç‰©ä½ç½®é”™è¯¯
// 2. åœ°å›¾ UI æ˜¾ç¤ºé”™è¯¯çš„åæ ‡
// 3. é€»è¾‘æ··ä¹±
```

---

## å·²å®Œæˆçš„ä¿®æ”¹

### 1. EchoGpuParamsManager.cpp

#### ä¿®æ”¹1ï¼šå…³é—­ GPU Camera-Relativeï¼ˆæµ‹è¯•ç”¨ï¼‰
```cpp
// ç¬¬44è¡Œ
static bool g_EnableGpuCameraRelative = false; // [CR TEST] æš‚æ—¶å…³é—­ï¼Œåªæµ‹è¯• CPU å±‚
```

#### ä¿®æ”¹2ï¼šæ³¨é‡Šæ‰æºå¤´ç»Ÿä¸€å¤„ç†ï¼ˆé¿å…æŒ‡é’ˆæ‚¬ç©ºï¼‰
```cpp
// ç¬¬729-737è¡Œ
// [CR] Camera-Relative çŸ©é˜µå˜æ¢ï¼ˆæºå¤´ç»Ÿä¸€å¤„ç†ï¼‰
// [CR NOTE] æš‚æ—¶æ³¨é‡Šæ‰æºå¤´å¤„ç†ï¼Œæ”¹ä¸ºåœ¨å„ uniform case ä¸­å•ç‹¬å¤„ç†ï¼ˆé¿å…æŒ‡é’ˆæ‚¬ç©ºï¼‰
/*
if (g_EnableGpuCameraRelative) {
    // é—®é¢˜ï¼šå±€éƒ¨å˜é‡ worldCR/invWorldCR åœ¨å‡½æ•°è¿”å›åè¢«é”€æ¯ï¼Œå¯¼è‡´æŒ‡é’ˆæ‚¬ç©º
    // è§£å†³æ–¹æ¡ˆï¼šæ”¹ä¸ºåœ¨å„ uniform case ä¸­å¤„ç†ï¼Œæˆ–ä½¿ç”¨æˆå‘˜å˜é‡
}
*/
```

---

### 2. EchoMiniMap.cpp

#### ä¿®æ”¹1ï¼šæ·»åŠ  Tick è°ƒç”¨æ£€æµ‹
```cpp
// ç¬¬1224-1232è¡Œ
void MiniMapManager::Tick() {
    // [CR DEBUG] ç¡®è®¤ Tick è¢«è°ƒç”¨
    static int s_tickCount = 0;
    static int s_logInterval = 60;
    if ((++s_tickCount % s_logInterval) == 0) {
        char buf[256];
        sprintf(buf, "[MiniMapManager::Tick] Called! Frame=%d mbInit=%d mbIsCreate=%d", 
            s_tickCount, mbInit ? 1 : 0, mbIsCreate ? 1 : 0);
        LogManager::instance()->logMessage(buf);
    }
    // ...
}
```

#### ä¿®æ”¹2ï¼šæ·»åŠ  WorldOrigin æ£€æŸ¥æ—¥å¿—
```cpp
// ç¬¬1252-1263è¡Œ
// [CR DEBUG] æ¯60å¸§æ‰“å°ä¸€æ¬¡æ£€æŸ¥çŠ¶æ€
if ((s_tickCount % 60) == 0) {
    char buf[512];
    sprintf(buf, "[WorldOrigin Check] Frame=%d FirstRebase=%d CurrentOrigin=(%.1f,%.1f,%.1f) CamPos=(%.1f,%.1f,%.1f) Offset=(%.1f,%.1f,%.1f) Dist=%.1fkm Threshold=%.1fkm",
        s_tickCount, s_firstRebase ? 1 : 0,
        currentOrigin.x, currentOrigin.y, currentOrigin.z,
        cameraPosD.x, cameraPosD.y, cameraPosD.z,
        offset.x, offset.y, offset.z,
        sqrt(offset.squaredLength()) / 1000.0,
        rebaseThreshold / 1000.0);
    LogManager::instance()->logMessage(buf);
}
```

#### ä¿®æ”¹3ï¼šä¸ä¿®æ”¹ mPlayerWorldPositionï¼ˆå…³é”®ä¿®å¤ï¼‰
```cpp
// ç¬¬1293-1297è¡Œ
// [CR NOTE] mPlayerWorldPosition ä¿æŒä¸–ç•Œåæ ‡ï¼ˆå¤§åæ ‡ï¼‰ï¼Œä¸ä¿®æ”¹ï¼
// å¤–éƒ¨ç³»ç»Ÿä¼šç»§ç»­ç”¨å¤§åæ ‡æ›´æ–°ï¼Œä½†åœ¨ä½¿ç”¨æ—¶éœ€è¦è½¬æ¢ä¸ºç›¸å¯¹åæ ‡
sprintf(logMsg, "[WorldOrigin Rebase] mPlayerWorldPosition keeps world coords: (%.1f,%.1f,%.1f) [ä¸ä¿®æ”¹ï¼Œä¿æŒå¤§åæ ‡]",
    mPlayerWorldPosition.x, mPlayerWorldPosition.y, mPlayerWorldPosition.z);
LogManager::instance()->logMessage(logMsg);
```

#### ä¿®æ”¹4ï¼šUpdatePlayerPosition ä¿æŒä¼ å…¥çš„ä¸–ç•Œåæ ‡
```cpp
// ç”¨æˆ·ä¿®æ”¹ï¼šæ’¤é”€äº†è‡ªåŠ¨è½¬æ¢é€»è¾‘
void MiniMapManager::UpdatePlayerPosition(const Vector3& InPosition) {
    mPlayerWorldPosition = InPosition;  // ç›´æ¥ä¿å­˜ä¸–ç•Œåæ ‡ï¼Œä¸è½¬æ¢
}
```

---

### 3. EchoKarstGroup.cpp

#### ä¿®æ”¹1ï¼šæ³¨å†Œç›‘å¬å™¨æ—¶æ·»åŠ æ—¥å¿—
```cpp
// ç¬¬127-130è¡Œ
Root::instance()->addWorldOriginListener(this);

// [CR DEBUG] ç¡®è®¤ç›‘å¬å™¨æ³¨å†ŒæˆåŠŸ
char logMsg[256];
sprintf(logMsg, "[KarstGroup::Init] WorldOriginListener registered! this=%p", this);
LogManager::instance()->logMessage(logMsg);
```

#### ä¿®æ”¹2ï¼šworldOriginRebasing æ·»åŠ è¯¦ç»†æ—¥å¿—
```cpp
// ç¬¬480-530è¡Œ
void KarstGroup::worldOriginRebasing(double origin_x, double orign_y, double origin_z) {
    // [CR DEBUG] é¦–å…ˆæ‰“å°è¢«è°ƒç”¨çš„æ¶ˆæ¯
    char logMsg[512];
    sprintf(logMsg, "========== [KarstGroup::worldOriginRebasing] CALLED! this=%p ==========", this);
    LogManager::instance()->logMessage(logMsg);
    
    // ... ä¸–ç•ŒåŸç‚¹å˜æ›´æ—¥å¿— ...
    
    // [CR CRITICAL] åŒæ­¥æ›´æ–°æ‰€æœ‰æ‘„åƒæœºä½ç½®ï¼
    Camera* mainCam = mSceneManager->getMainCamera();
    Camera* activeCam = mSceneManager->getActiveCamera();
    
    sprintf(logMsg, "[KarstGroup::worldOriginRebasing] MainCamera=%p ActiveCamera=%p Same=%d",
        mainCam, activeCam, (mainCam == activeCam) ? 1 : 0);
    LogManager::instance()->logMessage(logMsg);
    
    // æ›´æ–°ä¸»æ‘„åƒæœº
    if (mainCam) {
        DVector3 oldCamPos = mainCam->getPosition();
        DVector3 newCamPos = oldCamPos - offset;
        mainCam->setPosition(newCamPos);
        sprintf(logMsg, "[KarstGroup::worldOriginRebasing] MainCamera OldPos=(%.1f,%.1f,%.1f) NewPos=(%.1f,%.1f,%.1f)",
            oldCamPos.x, oldCamPos.y, oldCamPos.z,
            newCamPos.x, newCamPos.y, newCamPos.z);
        LogManager::instance()->logMessage(logMsg);
        
        // [CR DEBUG] éªŒè¯è®¾ç½®æ˜¯å¦ç”Ÿæ•ˆ
        DVector3 verifyPos = mainCam->getPosition();
        sprintf(logMsg, "[KarstGroup::worldOriginRebasing] MainCamera Verify after setPosition: (%.1f,%.1f,%.1f) [åº”è¯¥ç­‰äºNewPos]",
            verifyPos.x, verifyPos.y, verifyPos.z);
        LogManager::instance()->logMessage(logMsg);
    }
    
    // å¦‚æœ ActiveCamera ä¸åŒï¼Œä¹Ÿè¦æ›´æ–°
    if (activeCam && activeCam != mainCam) {
        // ... åŒæ ·çš„æ›´æ–°é€»è¾‘ ...
    }
}
```

#### ä¿®æ”¹3ï¼šfindVisibleObjects æ·»åŠ åæ ‡è¯Šæ–­
```cpp
// ç¬¬652-692è¡Œ
void KarstGroup::findVisibleObjects(const Camera* pCamera, RenderQueue* pQueue) {
    // [CR DEBUG] åœ°å½¢è§†é”¥å‰”é™¤è¯Šæ–­
    static int s_frameCount = 0;
    static DVector3 s_lastCamPos(0, 0, 0);
    bool debugTerrain = (++s_frameCount % 60) == 0;  // æ¯60å¸§æ‰“å°ä¸€æ¬¡
    
    if (debugTerrain && pCamera == mSceneManager->getMainCamera()) {
        Camera* mainCam = mSceneManager->getMainCamera();
        Camera* activeCam = mSceneManager->getActiveCamera();
        DVector3 camPos = pCamera->getPosition();
        DVector3 worldOrigin = Root::instance()->getWorldOrigin();
        
        char buf[1024];
        sprintf(buf, "[TERRAIN] Frame=%d pCamera=%p MainCam=%p ActiveCam=%p WorldOrigin=(%.1f,%.1f,%.1f) CamPos=(%.1f,%.1f,%.1f) mOriginPos=(%.1f,%.1f,%.1f) mWorldBasePos=(%.1f,%.1f,%.1f) BlocksTotal=%d",
            s_frameCount, pCamera, mainCam, activeCam, 
            worldOrigin.x, worldOrigin.y, worldOrigin.z,
            camPos.x, camPos.y, camPos.z,
            mOriginPosition.x, mOriginPosition.y, mOriginPosition.z,
            mWorldBasePosition.x, mWorldBasePosition.y, mWorldBasePosition.z,
            (int)mKarstBlocks.size());
        LogManager::instance()->logMessage(buf);
        
        // [CR CRITICAL] æ£€æŸ¥æ‘„åƒæœºåæ ‡æ˜¯å¦ç¬¦åˆé¢„æœŸ
        DVector3 expectedCamRelative = camPos - worldOrigin;
        if (fabs(expectedCamRelative.x) > 10000 || fabs(expectedCamRelative.z) > 10000) {
            sprintf(buf, "[TERRAIN] âš ï¸ WARNING: Camera is using WORLD coords! CamPos=(%.1f,%.1f,%.1f) WorldOrigin=(%.1f,%.1f,%.1f) RelativePos=(%.1f,%.1f,%.1f)",
                camPos.x, camPos.y, camPos.z,
                worldOrigin.x, worldOrigin.y, worldOrigin.z,
                expectedCamRelative.x, expectedCamRelative.y, expectedCamRelative.z);
            LogManager::instance()->logMessage(buf);
        }
        
        // [CR DEBUG] è®¡ç®—æ‘„åƒæœºä¸åœ°å½¢çš„è·ç¦»
        DVector3 terrainToCamera = camPos - mOriginPosition;
        double distKm = sqrt(terrainToCamera.squaredLength()) / 1000.0;
        sprintf(buf, "[TERRAIN] TerrainOriginToCamera Distance=%.1fkm [è§†é”¥å‰”é™¤é˜ˆå€¼é€šå¸¸<50km]",
            distKm);
        LogManager::instance()->logMessage(buf);
        
        s_lastCamPos = camPos;
    }
    // ...
}
```

---

## å½“å‰é—®é¢˜åˆ†æ

### é—®é¢˜ç¡®è®¤

**ç—‡çŠ¶**ï¼š
```
âœ… WorldOrigin Rebasing æœºåˆ¶æ­£å¸¸å·¥ä½œ
âœ… æ‘„åƒæœºåœ¨ worldOriginRebasing ä¸­è¢«æ­£ç¡®æ›´æ–°ä¸ºå°åæ ‡ (528, 200, 224)
âŒ 17ç§’åæ‘„åƒæœºåˆå˜å›å¤§åæ ‡ (-365472, 9.7, 432224)
âŒ åœ°å½¢è·ç¦» 2000 km â†’ è§†é”¥å‰”é™¤ â†’ ä¸å¯è§
```

**æ ¹æœ¬åŸå› **ï¼š
å¤–éƒ¨ç³»ç»Ÿï¼ˆå¯èƒ½æ˜¯è§’è‰²æ§åˆ¶å™¨ã€ç©å®¶ç³»ç»Ÿï¼‰æ¯å¸§éƒ½åœ¨ç”¨**ä¸–ç•Œåæ ‡**ï¼ˆå¤§åæ ‡ï¼‰è®¾ç½®æ‘„åƒæœºä½ç½®ï¼Œè¦†ç›–äº† worldOriginRebasing çš„æ›´æ–°ã€‚

**æ¨æµ‹çš„è°ƒç”¨é“¾**ï¼š
```cpp
// ä¼ªä»£ç 
void SomeExternalSystem::Update() {
    // è·å–ç©å®¶ä¸–ç•Œä½ç½®
    Vector3 playerWorldPos = GetPlayerPosition();  // (-365472, 6.8, 432214)
    
    // è®¡ç®—æ‘„åƒæœºä½ç½®ï¼ˆè·Ÿéšç©å®¶ï¼‰
    Vector3 cameraWorldPos = playerWorldPos + cameraOffset;
    
    // ç›´æ¥ç”¨ä¸–ç•Œåæ ‡è®¾ç½®æ‘„åƒæœº â† é—®é¢˜åœ¨è¿™é‡Œï¼
    mainCamera->setPosition(cameraWorldPos);  // æ¯å¸§éƒ½è¦†ç›–ï¼
}
```

### ä¸ºä»€ä¹ˆ mPlayerWorldPosition ä¸èƒ½ä¿®æ”¹

**ç”¨æˆ·çš„æ­£ç¡®çº æ­£**ï¼š

```
mPlayerWorldPosition = (-365472, 6.8, 432214)
  â†‘ è¿™æ˜¯ç©å®¶åœ¨æ•´ä¸ªå¤§åœ°å›¾ä¸­çš„çœŸå®ä½ç½®ï¼ˆä¸–ç•Œåæ ‡ï¼‰

å¦‚æœä¿®æ”¹ä¸ºç›¸å¯¹åæ ‡ï¼š
mPlayerWorldPosition = (528, 6.8, 214)
  â†‘ ç©å®¶å°±ä¼šè·‘åˆ°åœ°å›¾çš„ (528, 6.8, 214) ç‚¹ï¼
  â†‘ è¿™æ˜¯é”™è¯¯çš„ï¼äººç‰©åº”è¯¥åœ¨ (-365472, 6.8, 432214) ç‚¹ï¼

æ­£ç¡®çš„é€»è¾‘ï¼š
1. mPlayerWorldPosition å§‹ç»ˆä¿å­˜ä¸–ç•Œåæ ‡ï¼ˆå¤§åæ ‡ï¼‰
2. å¤–éƒ¨ç³»ç»Ÿç”¨ä¸–ç•Œåæ ‡æ›´æ–°ç©å®¶ä½ç½®å’Œæ‘„åƒæœº
3. åœ¨æ¸²æŸ“æ—¶ï¼Œæ‘„åƒæœºåº”è¯¥ä½¿ç”¨ç›¸å¯¹åæ ‡ï¼ˆå°åæ ‡ï¼‰
```

---

## ä¸‹ä¸€æ­¥è®¡åˆ’

### ğŸ¯ ç«‹å³éœ€è¦åšçš„

#### 1. è¿è¡Œè¯Šæ–­å¹¶æ”¶é›†æ—¥å¿— â³

**è¿è¡Œæ¸¸æˆå¹¶æœç´¢å…³é”®æ—¥å¿—**ï¼š
```bash
grep -E "\[WorldOrigin Rebase\]|\[KarstGroup::worldOriginRebasing\]|WARNING.*Camera|TERRAIN.*Frame=60" Echo.log
```

**é¢„æœŸçœ‹åˆ°çš„ä¿¡æ¯**ï¼š
```
[WorldOrigin Rebase] mPlayerWorldPosition keeps world coords: (-365472,197,432214)
[KarstGroup::worldOriginRebasing] MainCamera NewPos=(528,200,224)
[KarstGroup::worldOriginRebasing] MainCamera Verify: (528,200,224)

[60å¸§å]
[TERRAIN] âš ï¸ WARNING: Camera is using WORLD coords! 
          CamPos=(-365472,9.7,432224) 
          RelativePos=(528,9.7,224)
```

#### 2. ç¡®è®¤å¤–éƒ¨ç³»ç»Ÿè¦†ç›–æ‘„åƒæœºçš„ä½ç½® ğŸ”

**éœ€è¦æ‰¾åˆ°**ï¼š
- å“ªä¸ªç³»ç»Ÿåœ¨æ¯å¸§æ›´æ–°æ‘„åƒæœºï¼Ÿ
- è°ƒç”¨ `camera->setPosition()` çš„åœ°æ–¹
- æ˜¯å¦æœ‰è§’è‰²æ§åˆ¶å™¨ã€ç©å®¶ç³»ç»Ÿã€æ‘„åƒæœºè·Ÿéšç³»ç»Ÿï¼Ÿ

**å¯èƒ½çš„æ–‡ä»¶**ï¼š
- `PlayerController.cpp`
- `CharacterController.cpp`
- `CameraFollow.cpp`
- `ActorSystem.cpp`

---

### ğŸ”§ è§£å†³æ–¹æ¡ˆé€‰é¡¹

#### æ–¹æ¡ˆ Aï¼šä¿®æ”¹ Camera::setPositionï¼ˆæ¨èï¼‰

**åœ¨ Camera ç±»ä¸­è‡ªåŠ¨è½¬æ¢åæ ‡**ï¼š

```cpp
// EchoCamera.cpp
void Camera::setPosition(const DVector3& pos) {
    // [CR] è‡ªåŠ¨è½¬æ¢ä¸ºç›¸å¯¹åæ ‡
    if (Root::instance()->isWorldOriginRebasingEnabled()) {
        DVector3 worldOrigin = Root::instance()->getWorldOrigin();
        DVector3 relativePos = pos - worldOrigin;
        mPosition = relativePos;
        
        // [CR DEBUG] å¯é€‰æ—¥å¿—
        if (fabs(pos.x) > 100000 || fabs(pos.z) > 100000) {
            static int s_warnCount = 0;
            if ((++s_warnCount % 300) == 0) {
                LogManager::instance()->logMessage(
                    StringUtil::format("[Camera::setPosition] Auto-converted: world=(%.1f,%.1f,%.1f) relative=(%.1f,%.1f,%.1f)",
                    pos.x, pos.y, pos.z, relativePos.x, relativePos.y, relativePos.z)
                );
            }
        }
    } else {
        mPosition = pos;
    }
    
    invalidateView();
}
```

**ä¼˜ç‚¹**ï¼š
- âœ… å¯¹å¤–éƒ¨ç³»ç»Ÿé€æ˜ï¼Œæ— éœ€ä¿®æ”¹å¤§é‡ä»£ç 
- âœ… é›†ä¸­å¤„ç†ï¼Œç»´æŠ¤ç®€å•
- âœ… å‘åå…¼å®¹

**ç¼ºç‚¹**ï¼š
- âš ï¸ æ¯æ¬¡ setPosition éƒ½æœ‰é¢å¤–è®¡ç®—ï¼ˆæ€§èƒ½å½±å“å°ï¼‰

---

#### æ–¹æ¡ˆ Bï¼šæ‰¾åˆ°å¹¶ä¿®å¤å¤–éƒ¨ç³»ç»Ÿ

**å®šä½å¹¶ä¿®æ”¹è§’è‰²æ§åˆ¶å™¨**ï¼š

```cpp
// å‡è®¾åœ¨ PlayerController.cpp
void PlayerController::UpdateCamera() {
    Vector3 playerWorldPos = GetPlayerPosition();  // (-365472, 6.8, 432214)
    
    // [CR FIX] è½¬æ¢ä¸ºç›¸å¯¹åæ ‡
    DVector3 worldOrigin = Root::instance()->getWorldOrigin();
    Vector3 playerRelativePos = playerWorldPos - Vector3(worldOrigin);
    
    Vector3 cameraRelativePos = playerRelativePos + cameraOffset;
    mainCamera->setPosition(cameraRelativePos);  // ç”¨ç›¸å¯¹åæ ‡è®¾ç½®
}
```

**ä¼˜ç‚¹**ï¼š
- âœ… æ˜ç¡®æ§åˆ¶ï¼Œé€»è¾‘æ¸…æ™°
- âœ… é¿å…éšå¼è½¬æ¢

**ç¼ºç‚¹**ï¼š
- âŒ éœ€è¦æ‰¾åˆ°æ‰€æœ‰è®¾ç½®æ‘„åƒæœºçš„åœ°æ–¹
- âŒ å¯èƒ½æœ‰å¤šå¤„ä»£ç éœ€è¦ä¿®æ”¹
- âŒ å®¹æ˜“é—æ¼

---

#### æ–¹æ¡ˆ Cï¼šæ¯å¸§å¼ºåˆ¶æ ¡æ­£æ‘„åƒæœºï¼ˆä¸´æ—¶æ–¹æ¡ˆï¼‰

**åœ¨æ¸²æŸ“å‰å¼ºåˆ¶æ›´æ–°**ï¼š

```cpp
// EchoKarstGroup.cpp::findVisibleObjects
void KarstGroup::findVisibleObjects(const Camera* pCamera, RenderQueue* pQueue) {
    // [CR WORKAROUND] å¼ºåˆ¶æ ¡æ­£æ‘„åƒæœºåæ ‡
    if (pCamera == mSceneManager->getMainCamera()) {
        Camera* mainCam = const_cast<Camera*>(pCamera);  // å»æ‰ const
        DVector3 camPos = mainCam->getPosition();
        DVector3 worldOrigin = Root::instance()->getWorldOrigin();
        DVector3 relativePos = camPos - worldOrigin;
        
        // å¦‚æœæ‘„åƒæœºä½¿ç”¨çš„æ˜¯ä¸–ç•Œåæ ‡ï¼ˆå¤§åæ ‡ï¼‰ï¼Œå¼ºåˆ¶è½¬æ¢
        if (fabs(relativePos.x) > 10000 || fabs(relativePos.z) > 10000) {
            mainCam->setPosition(relativePos);  // å¼ºåˆ¶è®¾ç½®ä¸ºç›¸å¯¹åæ ‡
        }
    }
    
    // ... åŸæœ‰é€»è¾‘ ...
}
```

**ä¼˜ç‚¹**ï¼š
- âœ… å¿«é€Ÿä¿®å¤ï¼Œç«‹ç«¿è§å½±
- âœ… ä¸éœ€è¦æ‰¾å¤–éƒ¨ç³»ç»Ÿ

**ç¼ºç‚¹**ï¼š
- âŒ æ²»æ ‡ä¸æ²»æœ¬
- âŒ å¯èƒ½å¯¼è‡´æ‘„åƒæœºæŠ–åŠ¨
- âŒ æ€§èƒ½æµªè´¹ï¼ˆæ¯å¸§éƒ½æ£€æŸ¥ï¼‰

---

## å…³é”®ä»£ç ä¿®æ”¹è®°å½•

### æ–‡ä»¶æ¸…å•

| æ–‡ä»¶ | ä¿®æ”¹å†…å®¹ | çŠ¶æ€ |
|------|---------|------|
| `EchoGpuParamsManager.cpp` | å…³é—­ GPU CRï¼Œæ³¨é‡Šæºå¤´å¤„ç† | âœ… å®Œæˆ |
| `EchoMiniMap.cpp` | æ·»åŠ è¯Šæ–­æ—¥å¿—ï¼Œä¿æŒä¸–ç•Œåæ ‡ | âœ… å®Œæˆ |
| `EchoKarstGroup.cpp` | æ·»åŠ  rebasing æ—¥å¿—ï¼Œæ‘„åƒæœºéªŒè¯ | âœ… å®Œæˆ |
| `EchoCamera.cpp` | å¾…ä¿®æ”¹ï¼šè‡ªåŠ¨åæ ‡è½¬æ¢ | â³ å¾…å®š |

### Git çŠ¶æ€

```bash
Changes not staged for commit:
  modified:   EchoGpuParamsManager.cpp
  modified:   EchoKarstGroup.cpp
  modified:   EchoMiniMap.cpp

Untracked files:
  Echo.log
  å¤§ä¸–ç•Œæµ®ç‚¹ç²¾åº¦_CameraRelativeæŠ€æœ¯æ–¹æ¡ˆ.md
  å¤§ä¸–ç•Œæµ®ç‚¹ç²¾åº¦_é¡¹ç›®è¿›åº¦æŠ¥å‘Š.md (æœ¬æ–‡æ¡£)
  è°ƒè¯•æŒ‡å—_Camera_Relative_é—®é¢˜è¯Šæ–­.md
```

---

## æ—¥å¿—åˆ†æ

### å®Œæ•´æ—¥å¿—ç¤ºä¾‹ï¼ˆæœ€æ–°è¿è¡Œï¼‰

```
15:01:54: *-*-* ECHO Initialising
15:02:05: [KarstGroup::Init] WorldOriginListener registered! this=000001F510855B90

[åˆå§‹ Rebasing]
15:02:12: [WorldOrigin Rebase] FirstTime=1 Dist=566.0km 
          OldOrigin=(0.0,0.0,0.0) 
          NewOrigin=(-366000.0,0.0,432000.0) 
          Cam=(-365472.0,197.1,432214.4)
          
15:02:12: [WorldOrigin Rebase] After changeWorldOrigin: 
          before=(0.0,0.0,0.0) after=(-366000.0,0.0,432000.0)
          
15:02:12: [WorldOrigin Rebase] mPlayerWorldPosition keeps world coords: 
          (-365472.0,197.1,432214.4) [ä¸ä¿®æ”¹ï¼Œä¿æŒå¤§åæ ‡]

[å¸§æœ«å›è°ƒ]
15:02:12: ========== [KarstGroup::worldOriginRebasing] CALLED! ==========
15:02:12: [KarstGroup::worldOriginRebasing] 
          OldWorldBase=(0.0,0.0,0.0) 
          NewWorldBase=(-366000.0,0.0,432000.0) 
          Offset=(-366000.0,0.0,432000.0)
          
15:02:12: [KarstGroup::worldOriginRebasing] MainCamera=%p ActiveCamera=%p Same=1
15:02:12: [KarstGroup::worldOriginRebasing] MainCamera 
          OldPos=(-365472.0,200.0,432224.0) 
          NewPos=(528.0,200.0,224.0)  â† æˆåŠŸæ›´æ–°ä¸ºå°åæ ‡ï¼âœ…

[60å¸§å - é—®é¢˜å‡ºç°]
15:02:29: [MiniMapManager::Tick] Called! Frame=60 mbInit=1 mbIsCreate=1
15:02:29: [WorldOrigin Check] Frame=60 FirstRebase=0 
          CurrentOrigin=(-366000.0,0.0,432000.0) 
          CamPos=(-365472.0,6.8,432214.4)  â† åˆå˜å›å¤§åæ ‡ï¼âŒ
          Offset=(528.0,6.8,214.4) Dist=0.6km Threshold=10.0km
          
15:02:29: [TERRAIN] Frame=60 
          CamPos=(-365472.0,9.7,432224.0)  â† ç¡®è®¤ä½¿ç”¨å¤§åæ ‡
          mOriginPos=(-1731152.0,0.0,-1480576.0) 
          mWorldBasePos=(-366000.0,0.0,432000.0) 
          BlocksTotal=10965

[é¢„æœŸä½†ç¼ºå¤±çš„æ—¥å¿—]
15:02:29: [TERRAIN] âš ï¸ WARNING: Camera is using WORLD coords!  â† éœ€è¦æ·»åŠ 
```

### æ—¥å¿—è§£è¯»

| æ—¶é—´ | äº‹ä»¶ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|------|
| 15:02:05 | KarstGroup åˆå§‹åŒ– | âœ… | ç›‘å¬å™¨æ³¨å†ŒæˆåŠŸ |
| 15:02:12 | WorldOrigin Rebasing | âœ… | è§¦å‘é‡å®šä½ï¼Œè®¾ç½®æ–°ä¸–ç•ŒåŸç‚¹ |
| 15:02:12 | å›è°ƒæ›´æ–°æ‘„åƒæœº | âœ… | æ‘„åƒæœºæ›´æ–°ä¸ºå°åæ ‡ (528, 200, 224) |
| 15:02:29 | Frame=60 æ£€æŸ¥ | âŒ | æ‘„åƒæœºåˆæ˜¯å¤§åæ ‡ (-365472, 9.7, 432224) |
| - | è·ç¦»è®¡ç®— | âŒ | åœ°å½¢è·ç¦» 2000 km â†’ è§†é”¥å‰”é™¤ |

---

## æŠ€æœ¯å‚è€ƒ

### ç›¸å…³æ–‡æ¡£
- `å¤§ä¸–ç•Œæµ®ç‚¹ç²¾åº¦_CameraRelativeæŠ€æœ¯æ–¹æ¡ˆ.md` - å®Œæ•´çš„æ•°å­¦æ¨å¯¼å’Œç†è®º
- `è°ƒè¯•æŒ‡å—_Camera_Relative_é—®é¢˜è¯Šæ–­.md` - è°ƒè¯•æ­¥éª¤å’Œæ–­ç‚¹ä½ç½®
- `å¤§ä¸–ç•Œæµ®ç‚¹æ•°ç²¾åº¦é—®é¢˜.pdf` - åŸå§‹é—®é¢˜æè¿°

### å…³é”®æ¦‚å¿µ

#### åæ ‡ç³»å¯¹æ¯”

| ç±»å‹ | å®šä¹‰ | ç¤ºä¾‹ | ç²¾åº¦ |
|------|------|------|------|
| **ä¸–ç•Œåæ ‡** | ç›¸å¯¹äºåœ°å›¾åŸç‚¹(0,0,0) | (-365472, 200, 432224) | âŒ float ç²¾åº¦æŸå¤± |
| **ç›¸å¯¹åæ ‡** | ç›¸å¯¹äºå½“å‰ä¸–ç•ŒåŸç‚¹ | (528, 200, 224) | âœ… ç²¾åº¦å®Œç¾ |
| **ä¸–ç•ŒåŸç‚¹** | åŠ¨æ€è°ƒæ•´çš„å‚è€ƒç‚¹ | (-366000, 0, 432000) | - |

#### float ç²¾åº¦é™åˆ¶

```
float ç»“æ„ï¼š[ç¬¦å·ä½ 1bit][æŒ‡æ•° 8bit][å°¾æ•° 23bit]

å¤§æ•°å€¼ç¤ºä¾‹ï¼š
  -365472.0 (äºŒè¿›åˆ¶éœ€è¦ 19 ä½æ•´æ•°éƒ¨åˆ†)
  23 - 19 = 4 ä½å°æ•°ç²¾åº¦
  â†’ åªèƒ½ç²¾ç¡®åˆ° 2^-4 â‰ˆ 0.0625
  â†’ 0.5625 è¿™æ ·çš„å°æ•°ä¼šä¸¢å¤±ï¼

å°æ•°å€¼ç¤ºä¾‹ï¼š
  528.0 (äºŒè¿›åˆ¶éœ€è¦ 10 ä½æ•´æ•°éƒ¨åˆ†)
  23 - 10 = 13 ä½å°æ•°ç²¾åº¦
  â†’ å¯ä»¥ç²¾ç¡®åˆ° 2^-13 â‰ˆ 0.00012
  â†’ ç²¾åº¦æå‡ 200+ å€ï¼
```

---

## é™„å½•ï¼šShader ä»£ç 

### Shader æ˜¯å¦éœ€è¦ä¿®æ”¹ï¼Ÿ

**ç»“è®ºï¼šä¸éœ€è¦ä¿®æ”¹ Shaderï¼**

**ç†ç”±**ï¼š
å¦‚æœ CPU å±‚æ­£ç¡®å·¥ä½œï¼ˆæ‘„åƒæœºä½¿ç”¨ç›¸å¯¹åæ ‡ï¼‰ï¼ŒShader è‡ªåŠ¨å°±æ˜¯æ­£ç¡®çš„ï¼š

```hlsl
// KarstBiomeTerrain_PS.txt
float3 V = normalize(U_PS_CameraPosition.xyz - i_WorldPos.xyz);

// å¦‚æœï¼š
//   U_PS_CameraPosition = (528, 200, 224)  â† ç›¸å¯¹åæ ‡
//   i_WorldPos = (530, 200, 220)           â† ç›¸å¯¹åæ ‡ï¼ˆVSè¾“å‡ºï¼‰
// åˆ™ï¼š
//   V = normalize((528,200,224) - (530,200,220))
//     = normalize((-2,0,4))  â† æ­£ç¡®çš„æ–¹å‘å‘é‡ï¼
```

**é—®é¢˜ä¸åœ¨ Shaderï¼Œåœ¨ CPU å±‚çš„åæ ‡ä¸ä¸€è‡´ï¼**

---

## æ€»ç»“

### å·²è§£å†³
âœ… ç†è§£ Camera-Relative åŸç†  
âœ… å®šä½ GPU å±‚æŒ‡é’ˆæ‚¬ç©ºé—®é¢˜  
âœ… ç¡®è®¤ CPU å±‚ Rebasing æœºåˆ¶å­˜åœ¨ä¸”å·¥ä½œ  
âœ… å‘ç°æ‘„åƒæœºè¢«å¤–éƒ¨ç³»ç»Ÿè¦†ç›–çš„é—®é¢˜  
âœ… ç†è§£ mPlayerWorldPosition åº”ä¿æŒä¸–ç•Œåæ ‡  
âœ… æ·»åŠ å®Œæ•´çš„è¯Šæ–­æ—¥å¿—ç³»ç»Ÿ  

### å¾…è§£å†³
â³ æ‰¾åˆ°å¤–éƒ¨ç³»ç»Ÿè¦†ç›–æ‘„åƒæœºçš„ä½ç½®  
â³ é€‰æ‹©å¹¶å®ç°è§£å†³æ–¹æ¡ˆï¼ˆA/B/Cï¼‰  
â³ éªŒè¯ä¿®å¤ååœ°å½¢å’Œæ¤è¢«æ­£å¸¸æ˜¾ç¤º  
â³ é‡æ–°å¯ç”¨ GPU Camera-Relativeï¼ˆé•¿æœŸç›®æ ‡ï¼‰  

### å½“å‰ä¼˜å…ˆçº§
ğŸ”¥ **P0**: è¿è¡Œè¯Šæ–­ï¼Œç¡®è®¤ WARNING æ—¥å¿—  
ğŸ”¥ **P1**: å®ç°æ–¹æ¡ˆ Aï¼ˆCamera::setPosition è‡ªåŠ¨è½¬æ¢ï¼‰  
ğŸ“ **P2**: æµ‹è¯•éªŒè¯ï¼Œæ”¶é›†æ–°æ—¥å¿—  
ğŸ“ **P3**: ä¼˜åŒ–æ€§èƒ½ï¼Œæ¸…ç†è°ƒè¯•ä»£ç   

---

**æœ€åæ›´æ–°**: 2025-10-24 15:10  
**ä¸‹æ¬¡æ›´æ–°**: å®ç°è§£å†³æ–¹æ¡ˆåæ›´æ–°æœ¬æ–‡æ¡£


