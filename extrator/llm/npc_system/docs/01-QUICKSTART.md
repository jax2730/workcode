# 01 - 快速入门指南

欢迎！这份指南将帮助你在5分钟内运行起NPC对话系统。

## 🎯 目标

完成本指南后，你将能够：
- ✅ 启动NPC对话系统
- ✅ 与NPC进行对话
- ✅ 查看对话历史
- ✅ 理解基本概念

---

## 📋 前置条件

### 必需
- ✅ Python 3.8+
- ✅ Ollama服务运行中
- ✅ qwen2.5模型已安装

### 验证环境

```bash
# 1. 检查Python版本
python --version
# 应该显示: Python 3.8.x 或更高

# 2. 检查Ollama是否运行
curl http://localhost:11434/api/tags
# 应该返回模型列表

# 3. 检查qwen2.5模型
ollama list | grep qwen2.5
# 应该看到 qwen2.5 模型
```

如果以上任何一项失败，请先阅读 [02-安装配置指南](./02-INSTALLATION.md)。

---

## 🚀 第一次运行

### 步骤1: 进入项目目录

```bash
cd ~/OllamaSpace/SceneAgentServer
```

### 步骤2: 初始化数据目录

```bash
python -m extrator.llm.npc_system.init_data_dirs
```

**你会看到**:
```
[SQLiteDialogueStore] 数据库初始化完成: ./npc_data/databases/dialogue_history.db
[RelationshipManager] 数据库初始化完成: ./npc_data/databases/npc_relationship.db
✅ 数据目录初始化完成
```

**这一步做了什么？**
- 创建了 `npc_data/` 目录
- 初始化了SQLite数据库
- 创建了各种子目录（memories、exports等）

### 步骤3: 启动对话系统

```bash
python -m extrator.llm.npc_system.npc_chat
```

**你会看到**:
```
============================================================
🎮 NPC对话系统 - 命令行版
============================================================

[1/3] 初始化数据目录...
✅ 数据目录: ./npc_data

[2/3] 初始化LLM (qwen2.5)...
✅ LLM连接成功

[3/3] 初始化NPC管理器...
✅ 已加载 1 个NPC配置

============================================================
📋 可用的NPC列表:
============================================================

【已配置的NPC】
  1. innkeeper: 旅店老板娘 (旅店老板)

【预定义模板】
  T1. blacksmith: 老铁匠 (铁匠)
  T2. merchant: 精明商人 (商人)
  T3. innkeeper: 旅店老板娘 (旅店老板)
  T4. guard: 守卫队长 (守卫)

请输入NPC ID (或输入 'quit' 退出):
NPC ID: 
```

### 步骤4: 选择NPC

输入 `innkeeper` 并按回车：

```
NPC ID: innkeeper

✅ 已选择: 旅店老板娘 (旅店老板)

旅店老板娘: 哎呀，来客人了！要住店还是吃饭？
------------------------------------------------------------
```

### 步骤5: 开始对话

现在你可以和NPC对话了！

```
你: 你好，我想了解一下这个镇子

旅店老板娘: 哎呀，欢迎欢迎！这个镇子啊，虽然不大，但是很热闹的...
（NPC会根据人设回复）

  [好感度: 熟悉 (52/100)] [响应时间: 2.34秒]
------------------------------------------------------------
```

**恭喜！🎉 你已经成功运行了第一次对话！**

---

## 💡 基本命令

在对话中，你可以使用以下命令：

### 查看历史
```
你: history
```
显示最近10条对话记录。

### 查看状态
```
你: status
```
显示NPC信息和好感度。

### 查看统计
```
你: stats
```
显示响应时间统计。

### 切换NPC
```
你: switch
```
切换到其他NPC对话。

### 导出对话
```
你: export
```
将对话导出为Excel文件。

### 退出
```
你: quit
```
退出对话系统。

---

## 🎮 完整对话示例

```
你: 你好

旅店老板娘: 哎呀，来客人了！要住店还是吃饭？
  [好感度: 熟悉 (52/100)] [响应时间: 1.23秒]
------------------------------------------------------------

你: 我想了解一下这个镇子的情况

旅店老板娘: 这个镇子啊，虽然不大，但很热闹。有铁匠铺、杂货店，
还有守卫队维护治安。你是第一次来吧？
  [好感度: 熟悉 (54/100)] [响应时间: 2.15秒]
------------------------------------------------------------

你: status

╔════════════════════════════════════════════════════════════╗
║                    NPC状态                                  ║
╠════════════════════════════════════════════════════════════╣
║  NPC ID:    innkeeper                                       ║
║  名称:      旅店老板娘                                      ║
║  角色:      旅店老板                                        ║
║  好感度:    熟悉                                            ║
║  分数:      54/100                                          ║
║  互动次数:  2                                               ║
╠════════════════════════════════════════════════════════════╣
║  玩家ID:    player_c6f2a3d9                                 ║
║  会话ID:    session_20260117_143022                         ║
╚════════════════════════════════════════════════════════════╝

你: history

📜 最近对话历史 (2 条):
------------------------------------------------------------
[2026-01-17 14:30] 你: 你好...
[2026-01-17 14:30] 旅店老板娘: 哎呀，来客人了！要住店还是吃饭？...
[2026-01-17 14:31] 你: 我想了解一下这个镇子的情况...
[2026-01-17 14:31] 旅店老板娘: 这个镇子啊，虽然不大，但很热闹...
------------------------------------------------------------

你: quit

再见!

============================================================
感谢使用NPC对话系统!
============================================================
```

---

## 🔍 理解发生了什么

### 1. 数据存储

你的对话被保存在多个地方：

```
npc_data/
├── databases/
│   ├── dialogue_history.db      # SQLite数据库（快速查询）
│   └── npc_relationship.db      # 好感度数据库
├── memories/
│   └── dialogues/
│       └── innkeeper/
│           └── player_xxx/      # 你的对话记录（Markdown）
└── exports/
    └── excel/                   # Excel导出文件
```

### 2. 好感度变化

每次对话，好感度都会变化：
- 正面对话：+1~5分
- 中性对话：+0~2分
- 负面对话：-1~5分

好感度等级：
- 0-20分：陌生
- 21-40分：熟悉
- 41-60分：友好
- 61-80分：亲密
- 81-100分：挚友

### 3. 记忆系统

NPC会记住：
- **工作记忆**: 当前对话的内容
- **情景记忆**: 你们之间发生的事件
- **语义记忆**: NPC的知识和经验
- **感知记忆**: 环境信息

### 4. 响应时间

响应时间包括：
- 记忆检索：0.2-0.5秒
- 知识库查询：0.2-1.0秒
- LLM推理：1-3秒
- 数据存储：0.1-0.2秒

---

## 🎯 下一步

### 选项1: 创建自定义NPC
阅读 [11-创建NPC指南](./11-CREATE_NPC.md) 学习如何创建自己的NPC。

### 选项2: 深入理解系统
阅读 [03-系统架构总览](./03-ARCHITECTURE_OVERVIEW.md) 了解系统如何工作。

### 选项3: 编程使用
阅读 [13-API使用指南](./13-API_USAGE.md) 学习如何在代码中使用。

---

## ❓ 常见问题

### Q: 为什么响应这么慢？
A: NPC系统比简单对话慢2-4秒，因为它要检索记忆、查询知识库、计算好感度等。这是正常的。详见 [17-性能优化指南](./17-PERFORMANCE.md)。

### Q: 重启后对话历史还在吗？
A: 在！对话历史保存在数据库中，重启后会自动加载。你的玩家ID保存在 `npc_data/.player_id` 文件中。

### Q: 如何重置游戏进度？
A: 在对话中输入 `reset_player` 命令，会创建新的玩家ID，相当于开始新档案。

### Q: 可以同时和多个NPC对话吗？
A: 可以！使用 `switch` 命令切换NPC，每个NPC都会记住你们的对话。

### Q: 如何修改NPC的性格？
A: 编辑 `npc_configs/` 目录下的JSON配置文件。详见 [12-配置文件说明](./12-CONFIG_FILES.md)。

---

## 🎉 完成！

恭喜你完成了快速入门！现在你已经知道如何：
- ✅ 启动NPC对话系统
- ✅ 与NPC进行对话
- ✅ 使用基本命令
- ✅ 理解数据存储位置

继续探索其他文档，深入了解这个强大的系统吧！🚀
